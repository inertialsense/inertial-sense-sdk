<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>SDK: src/GpsParser.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo_Full_color_300x61.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDK
   &#160;<span id="projectnumber">Release 1.1.4</span>
   </div>
   <div id="projectbrief">Communications, logger, and bootloader libraries.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GpsParser.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">MIT LICENSE</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">Copyright 2014 Inertial Sense, LLC - http://inertialsense.com</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files(the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions :</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;GpsParser.h&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;com_manager.h&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#if defined(__GNUC__)</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#pragma GCC diagnostic push</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#pragma GCC diagnostic ignored &quot;-Wpedantic&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#define UBLOX_PREAMBLE1 0xb5</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#define UBLOX_PREAMBLE2 0x62</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#define UBLOX_HEADER_SIZE 6</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#define UBLOX_CHECKSUM_SIZE 2</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#if defined(RTK_EMBEDDED)</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#define INIT_M_RTCM init_rtcm(&amp;m_rtcm, 0); SetReceiverIndex(RECEIVER_INDEX_BASE_STATION);</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#define ALLOCATE_M_RTCM if (!m_rtcm.ownsBuff) { m_rtcm.buff = (unsigned char*)RTK_MALLOC(MAXRTCMLEN); m_rtcm.ownsBuff = 1; }</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#define INIT_M_RAW(fmt) init_raw(&amp;m_raw, fmt, 0); SetReceiverIndex(RECEIVER_INDEX_ROVER);</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#define ALLOCATE_M_RAW if (!m_raw.ownsBuff) { m_raw.buff = (unsigned char*)RTK_MALLOC(MAXRAWLEN);   m_raw.ownsBuff = 1; }</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#define DECLARE_RTCM_DESTRUCTOR(class_name) ~class_name() OVERRIDE { free_rtcm(&amp;m_rtcm); }</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#define DECLARE_RAW_DESTRUCTOR(class_name) ~class_name() OVERRIDE { free_raw(&amp;m_raw); }</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#define DECLARE_M_RTCM rtcm_t m_rtcm;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#define DECLARE_M_RAW raw_t m_raw;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#define calculate24BitCRCQ rtk_crc24q</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#define getBitsAsUInt32 getbitu</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">extern</span> <span class="keywordtype">int</span> decode_rtcm3(rtcm_t *rtcm);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keyword">extern</span> <span class="keywordtype">int</span> decode_ubx(raw_t* raw, <span class="keywordtype">int</span> doChecksum);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<a class="code" href="structgtime__t.html">gtime_t</a> g_gps_latest_time;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#define INIT_M_RTCM m_rtcm.len = 0; m_rtcm.nbyte = 0;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#define ALLOCATE_M_RTCM</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#define INIT_M_RAW(fmt) m_raw.len = 0; m_raw.nbyte = 0;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#define ALLOCATE_M_RAW</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#define DECLARE_RTCM_DESTRUCTOR(c)</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#define DECLARE_RAW_DESTRUCTOR(c)</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#define DECLARE_M_RTCM struct { uint8_t buff[2048]; int len; int nbyte; } m_rtcm;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#define DECLARE_M_RAW struct { uint8_t buff[2048]; int len; int nbyte; } m_raw;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">static</span> uint32_t calculate24BitCRCQ(uint8_t* buffer, uint32_t len)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t TABLE_CRC24Q[] =</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        0x000000,0x864CFB,0x8AD50D,0x0C99F6,0x93E6E1,0x15AA1A,0x1933EC,0x9F7F17,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        0xA18139,0x27CDC2,0x2B5434,0xAD18CF,0x3267D8,0xB42B23,0xB8B2D5,0x3EFE2E,</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        0xC54E89,0x430272,0x4F9B84,0xC9D77F,0x56A868,0xD0E493,0xDC7D65,0x5A319E,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        0x64CFB0,0xE2834B,0xEE1ABD,0x685646,0xF72951,0x7165AA,0x7DFC5C,0xFBB0A7,</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        0x0CD1E9,0x8A9D12,0x8604E4,0x00481F,0x9F3708,0x197BF3,0x15E205,0x93AEFE,</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        0xAD50D0,0x2B1C2B,0x2785DD,0xA1C926,0x3EB631,0xB8FACA,0xB4633C,0x322FC7,</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        0xC99F60,0x4FD39B,0x434A6D,0xC50696,0x5A7981,0xDC357A,0xD0AC8C,0x56E077,</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        0x681E59,0xEE52A2,0xE2CB54,0x6487AF,0xFBF8B8,0x7DB443,0x712DB5,0xF7614E,</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        0x19A3D2,0x9FEF29,0x9376DF,0x153A24,0x8A4533,0x0C09C8,0x00903E,0x86DCC5,</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        0xB822EB,0x3E6E10,0x32F7E6,0xB4BB1D,0x2BC40A,0xAD88F1,0xA11107,0x275DFC,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        0xDCED5B,0x5AA1A0,0x563856,0xD074AD,0x4F0BBA,0xC94741,0xC5DEB7,0x43924C,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        0x7D6C62,0xFB2099,0xF7B96F,0x71F594,0xEE8A83,0x68C678,0x645F8E,0xE21375,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        0x15723B,0x933EC0,0x9FA736,0x19EBCD,0x8694DA,0x00D821,0x0C41D7,0x8A0D2C,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        0xB4F302,0x32BFF9,0x3E260F,0xB86AF4,0x2715E3,0xA15918,0xADC0EE,0x2B8C15,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        0xD03CB2,0x567049,0x5AE9BF,0xDCA544,0x43DA53,0xC596A8,0xC90F5E,0x4F43A5,</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        0x71BD8B,0xF7F170,0xFB6886,0x7D247D,0xE25B6A,0x641791,0x688E67,0xEEC29C,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        0x3347A4,0xB50B5F,0xB992A9,0x3FDE52,0xA0A145,0x26EDBE,0x2A7448,0xAC38B3,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        0x92C69D,0x148A66,0x181390,0x9E5F6B,0x01207C,0x876C87,0x8BF571,0x0DB98A,</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        0xF6092D,0x7045D6,0x7CDC20,0xFA90DB,0x65EFCC,0xE3A337,0xEF3AC1,0x69763A,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        0x578814,0xD1C4EF,0xDD5D19,0x5B11E2,0xC46EF5,0x42220E,0x4EBBF8,0xC8F703,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        0x3F964D,0xB9DAB6,0xB54340,0x330FBB,0xAC70AC,0x2A3C57,0x26A5A1,0xA0E95A,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        0x9E1774,0x185B8F,0x14C279,0x928E82,0x0DF195,0x8BBD6E,0x872498,0x016863,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        0xFAD8C4,0x7C943F,0x700DC9,0xF64132,0x693E25,0xEF72DE,0xE3EB28,0x65A7D3,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        0x5B59FD,0xDD1506,0xD18CF0,0x57C00B,0xC8BF1C,0x4EF3E7,0x426A11,0xC426EA,</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        0x2AE476,0xACA88D,0xA0317B,0x267D80,0xB90297,0x3F4E6C,0x33D79A,0xB59B61,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        0x8B654F,0x0D29B4,0x01B042,0x87FCB9,0x1883AE,0x9ECF55,0x9256A3,0x141A58,</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        0xEFAAFF,0x69E604,0x657FF2,0xE33309,0x7C4C1E,0xFA00E5,0xF69913,0x70D5E8,</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        0x4E2BC6,0xC8673D,0xC4FECB,0x42B230,0xDDCD27,0x5B81DC,0x57182A,0xD154D1,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        0x26359F,0xA07964,0xACE092,0x2AAC69,0xB5D37E,0x339F85,0x3F0673,0xB94A88,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        0x87B4A6,0x01F85D,0x0D61AB,0x8B2D50,0x145247,0x921EBC,0x9E874A,0x18CBB1,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        0xE37B16,0x6537ED,0x69AE1B,0xEFE2E0,0x709DF7,0xF6D10C,0xFA48FA,0x7C0401,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        0x42FA2F,0xC4B6D4,0xC82F22,0x4E63D9,0xD11CCE,0x575035,0x5BC9C3,0xDD8538</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    };</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    uint32_t crc = 0;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i != len; i++)</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        crc = ((crc &lt;&lt; 8) &amp; 0xFFFFFF) ^ TABLE_CRC24Q[(crc &gt;&gt; 16) ^ buffer[i]];</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">return</span> crc;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="keyword">static</span> uint32_t getBitsAsUInt32(<span class="keyword">const</span> uint8_t* buffer, uint32_t pos, uint32_t len)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    uint32_t bits = 0;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = pos; i &lt; pos + len; i++)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        bits = (bits &lt;&lt; 1) + ((buffer[i / 8] &gt;&gt; (7 - i % 8)) &amp; 1u);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span> bits;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;}</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="classc_inertial_sense_parser.html">  129</a></span>&#160;<span class="keyword">class </span><a class="code" href="classc_inertial_sense_parser.html">cInertialSenseParser</a> : <span class="keyword">public</span> <a class="code" href="classc_gps_parser.html">cGpsParser</a></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;{</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classc_inertial_sense_parser.html">cInertialSenseParser</a>(<a class="code" href="classi_gps_parser_delegate.html">iGpsParserDelegate</a>* delegate) : <a class="code" href="classc_gps_parser.html#a5600c0ca39301545821df51a0292d270">cGpsParser</a>(delegate)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        m_len = 0;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="classc_inertial_sense_parser.html#a946b92985b6663bccd5f02d6afee1776">  137</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classc_inertial_sense_parser.html#a946b92985b6663bccd5f02d6afee1776">WriteByte</a>(uint8_t b) OVERRIDE</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">// note that no checksum is done, we assume a valid packet which should be the case 99.99% of the time</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// other types of parsers cannot do this because they do not have the concept of an end packet byte</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> (b == PSC_START_BYTE)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="comment">// write the start byte if we haven&#39;t written any bytes</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">if</span> (m_len == 0)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="comment">// write the start byte</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                m_buf[m_len++] = b;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="comment">// clear, corrupt data</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                m_len = 0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_len == _ARRAY_ELEMENT_COUNT(m_buf))</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="comment">// corrupt data</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            m_len = 0;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="comment">// write the byte</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            m_buf[m_len++] = b;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="keywordflow">if</span> (b == PSC_END_BYTE)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                <span class="comment">// data packet must be 4 bytes header + 4 bytes footer + 12 bytes data header + min 4 bytes data</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                <span class="keywordflow">if</span> (m_len &gt; 23)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#a592450747817cba6ca018c4fe99281b4">OnPacketReceived</a>(<span class="keyword">this</span>, m_buf, m_len);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                m_len = 0;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    uint8_t m_buf[2048];</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    uint32_t m_len;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;};</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="classc_rtcm_parser.html">  182</a></span>&#160;<span class="keyword">class </span><a class="code" href="classc_rtcm_parser.html">cRtcmParser</a> : <span class="keyword">public</span> <a class="code" href="classc_gps_parser.html">cGpsParser</a></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="classc_rtcm_parser.html">cRtcmParser</a>(<a class="code" href="classi_gps_parser_delegate.html">iGpsParserDelegate</a>* delegate) : <a class="code" href="classc_gps_parser.html#a5600c0ca39301545821df51a0292d270">cGpsParser</a>(delegate)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        INIT_M_RTCM;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    DECLARE_RTCM_DESTRUCTOR(<a class="code" href="classc_rtcm_parser.html">cRtcmParser</a>);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classc_rtcm_parser.html#aa49ac9396fcf583ddbb1f7bcf2e6af71">  192</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classc_rtcm_parser.html#aa49ac9396fcf583ddbb1f7bcf2e6af71">WriteByte</a>(uint8_t b) OVERRIDE</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        ALLOCATE_M_RTCM;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// if we have no bytes yet, check for header</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// if we have exactly 3 bytes, we have enough to calculate the length</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// fewer than 3 bytes and we want to exit out early</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> (m_rtcm.len &lt;= 3)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="comment">// check for header byte</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">if</span> (m_rtcm.len == 0)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="comment">// 0xD3 is the first byte in an RTCM3 message</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">if</span> (b != 0xD3)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                    <span class="comment">// corrupt data</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_rtcm.len == 3)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                uint32_t msgLength = getBitsAsUInt32(m_rtcm.buff, 14, 10);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                <span class="keywordflow">if</span> (msgLength &gt; 1023)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    <span class="comment">// corrupt data</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    m_rtcm.len = 0;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    <span class="comment">// message length only includes the message bytes, not the header or 3 CRC bytes at the end</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    <span class="comment">// plus 2 because we will be appending the first byte of the message or CRC bytes</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                    m_rtcm.nbyte = msgLength + 2;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="comment">// append the byte</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            m_rtcm.buff[m_rtcm.len++] = b;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">// append the byte</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        m_rtcm.buff[m_rtcm.len++] = b;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="comment">// see if we are done reading bytes, if so calculate CRC and forward the message on to the uINS if it is valid</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span> (--m_rtcm.nbyte == 0)</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="comment">// if the message is large enough, forward it on</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span> (m_rtcm.len &gt; 5)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="comment">// calculate length without crc bytes</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                uint32_t lenWithoutCrc = m_rtcm.len - 3;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="comment">// the CRC calculation does not include the 3 CRC bytes at the end for obvious reasons</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                uint32_t actualCRC = calculate24BitCRCQ(m_rtcm.buff, lenWithoutCrc);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="comment">// get the CRC from the last 3 bytes of the message</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                uint32_t correctCRC = getBitsAsUInt32(m_rtcm.buff + lenWithoutCrc, 0, 24);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="comment">// if valid CRC, forward mesasge to uINS</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordflow">if</span> (actualCRC == correctCRC)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;OnPacketReceived(<span class="keyword">this</span>, m_rtcm.buff, m_rtcm.len))</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        <a class="code" href="classc_gps_parser.html#ac5aa480f135a3405b720bc7bc370a5ac">ParseMessage</a>(m_rtcm.buff, m_rtcm.len);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    <span class="comment">// corrupt data</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            m_rtcm.len = 0;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="classc_rtcm_parser.html#ae85ccd9e816c808f696f730f10b34b45">  268</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classc_rtcm_parser.html#ae85ccd9e816c808f696f730f10b34b45">ParseMessage</a>(<span class="keyword">const</span> uint8_t* data, <span class="keywordtype">int</span> dataLength) OVERRIDE</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        (void)data;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        (void)dataLength;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor">#if defined(RTK_EMBEDDED)</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="preprocessor">#if PLATFORM_IS_ARM</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        m_rtcm.time = g_gps_latest_time;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">if</span> (g_gps_latest_time.<a class="code" href="structgtime__t.html#a8b130d86698a8a9e3c3a7a5c590eb392">time</a> == 0)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            m_rtcm.<a class="code" href="structgtime__t.html#a8b130d86698a8a9e3c3a7a5c590eb392">time</a> = utc2gpst(timeget());</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            m_rtcm.time = g_gps_latest_time;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">if</span> (m_rtcm.time.time == 0)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="comment">// cannot parse until start time is set</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_rtcm.buff != data)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="keywordflow">if</span> (m_rtcm.ownsBuff)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                RTK_FREE(m_rtcm.buff);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            m_rtcm.ownsBuff = 0;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            m_rtcm.buff = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)data;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        m_rtcm.len = dataLength;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">switch</span> (decode_rtcm3(&amp;m_rtcm))</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_OBSERVATION:</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="struct_p_a_c_k_e_d.html">obsd_t</a>* ptr = m_rtcm.obs.data, *ptrEnd = m_rtcm.obs.data + m_rtcm.obs.n; ptr != ptrEnd; ptr++)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                ptr-&gt;rcv = <a class="code" href="classc_gps_parser.html#a1bf50414df7d8d053cdd09bf04679253">GetReceiverIndex</a>();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#a3d84621cccf117972b96af70c6e2c86a">OnObservationReceived</a>(<span class="keyword">this</span>, &amp;m_rtcm.obs);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_EPHEMERIS:</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordtype">int</span> prn;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">switch</span> (satsys(m_rtcm.ephsat, &amp;prn))</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">case</span> SYS_GPS:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#ad51fee5d3324537e4a9a8664237b8626">OnGpsEphemerisReceived</a>(<span class="keyword">this</span>, &amp;m_rtcm.eph, prn);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordflow">case</span> SYS_GLO:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#ab711598d3e65ae1b7ba4e7a04afedc29">OnGlonassEphemerisReceived</a>(<span class="keyword">this</span>, &amp;m_rtcm.geph, prn);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_ANTENNA_POSITION:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#a1fea12f01b07177946f1ce10cd26eb9a">OnStationReceived</a>(<span class="keyword">this</span>, &amp;m_rtcm.sta);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        m_rtcm.len = 0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    DECLARE_M_RTCM;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;};</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classc_ublox_parser.html">  346</a></span>&#160;<span class="keyword">class </span><a class="code" href="classc_ublox_parser.html">cUbloxParser</a> : <span class="keyword">public</span> <a class="code" href="classc_gps_parser.html">cGpsParser</a></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="classc_ublox_parser.html">cUbloxParser</a>(<a class="code" href="classi_gps_parser_delegate.html">iGpsParserDelegate</a>* delegate) : <a class="code" href="classc_gps_parser.html#a5600c0ca39301545821df51a0292d270">cGpsParser</a>(delegate)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        Reset();</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        INIT_M_RAW(STRFMT_UBX);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    DECLARE_RAW_DESTRUCTOR(<a class="code" href="classc_ublox_parser.html">cUbloxParser</a>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="classc_ublox_parser.html#a4daf658f9f6edf2cc1bbf6dfe5a60660">  357</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classc_ublox_parser.html#a4daf658f9f6edf2cc1bbf6dfe5a60660">WriteByte</a>(uint8_t b) OVERRIDE</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        ALLOCATE_M_RAW;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">switch</span> (m_raw.len)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">if</span> (b == UBLOX_PREAMBLE1)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                m_raw.buff[m_raw.len++] = b;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span> (b != UBLOX_PREAMBLE2)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="comment">// corrupt data</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                Reset();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            m_raw.buff[m_raw.len++] = b;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            m_classId = b;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            m_raw.buff[m_raw.len++] = b;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            m_messageId = b;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">case</span> 4: <span class="comment">// payload 1</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">case</span> 5: <span class="comment">// payload 2</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            m_raw.buff[m_raw.len++] = b;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">case</span> UBLOX_HEADER_SIZE:</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <span class="comment">// add 2 bytes for the checksum</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            m_raw.nbyte = BE_SWAP16(*(uint16_t*)(m_raw.buff + 4)) + UBLOX_CHECKSUM_SIZE;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="comment">// if packet size is larger than buffer minus header and checksum</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="keywordflow">if</span> (m_raw.nbyte &lt; UBLOX_CHECKSUM_SIZE || (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)m_raw.nbyte &gt; <span class="keyword">sizeof</span>(m_raw.buff) - UBLOX_HEADER_SIZE)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <span class="comment">// corrupt data</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                Reset();</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        m_raw.buff[m_raw.len++] = b;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> (--m_raw.nbyte == 0)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="comment">// get actual checksum</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            uint8_t checksum1 = m_raw.buff[m_raw.len - 2];</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            uint8_t checksum2 = m_raw.buff[m_raw.len - 1];</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            uint8_t actualChecksum1, actualChecksum2;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="comment">// checksum does not include the two preamble bytes</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            CalculateChecksum(m_raw.buff, m_raw.len, actualChecksum1, actualChecksum2);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">if</span> (checksum1 == actualChecksum1 &amp;&amp; checksum2 == actualChecksum2)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;OnPacketReceived(<span class="keyword">this</span>, m_raw.buff, m_raw.len))</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <a class="code" href="classc_gps_parser.html#ac5aa480f135a3405b720bc7bc370a5ac">ParseMessage</a>(m_raw.buff, m_raw.len);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                <span class="comment">// corrupt data</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            Reset();</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno"><a class="line" href="classc_ublox_parser.html#a52295ab27f45764fbb6f145e34acdedd">  425</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classc_ublox_parser.html#a52295ab27f45764fbb6f145e34acdedd">ParseMessage</a>(<span class="keyword">const</span> uint8_t* data, <span class="keywordtype">int</span> dataLength) OVERRIDE</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        (void)data;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        (void)dataLength;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor">#if defined(RTK_EMBEDDED)</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">if</span> (m_raw.buff != data)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keywordflow">if</span> (m_raw.ownsBuff)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                RTK_FREE(m_raw.buff);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            m_raw.ownsBuff = 0;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            m_raw.buff = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)data;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        m_raw.len = dataLength;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">switch</span> (decode_ubx(&amp;m_raw, 0))</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_OBSERVATION:</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="struct_p_a_c_k_e_d.html">obsd_t</a>* ptr = m_raw.obs.data, *ptrEnd = m_raw.obs.data + m_raw.obs.n; ptr != ptrEnd; ptr++)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                ptr-&gt;rcv = <a class="code" href="classc_gps_parser.html#a1bf50414df7d8d053cdd09bf04679253">GetReceiverIndex</a>();</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#a3d84621cccf117972b96af70c6e2c86a">OnObservationReceived</a>(<span class="keyword">this</span>, &amp;m_raw.obs);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_EPHEMERIS:</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordtype">int</span> prn;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordflow">switch</span> (satsys(m_raw.ephsat, &amp;prn))</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">case</span> SYS_GPS:</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#ad51fee5d3324537e4a9a8664237b8626">OnGpsEphemerisReceived</a>(<span class="keyword">this</span>, &amp;m_raw.eph, prn);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordflow">case</span> SYS_GLO:</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#ab711598d3e65ae1b7ba4e7a04afedc29">OnGlonassEphemerisReceived</a>(<span class="keyword">this</span>, &amp;m_raw.geph, prn);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_SBS:</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#a94a8e9fc5ffaf0635a5c19d468701a48">OnSbsReceived</a>(<span class="keyword">this</span>, &amp;m_raw.sbsmsg);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">case</span> DATA_TYPE_ANTENNA_POSITION:</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <a class="code" href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">GetDelegate</a>()-&gt;<a class="code" href="classi_gps_parser_delegate.html#a1fea12f01b07177946f1ce10cd26eb9a">OnStationReceived</a>(<span class="keyword">this</span>, &amp;m_raw.sta);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        Reset();</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordtype">void</span> Reset()</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        m_raw.len = m_raw.nbyte = 0;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        m_messageId = 0;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        m_classId = 0;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    }</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">void</span> CalculateChecksum(<span class="keyword">const</span> uint8_t* data, <span class="keywordtype">int</span> dataLength, uint8_t&amp; checksum1, uint8_t&amp; checksum2)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        checksum1 = 0;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        checksum2 = 0;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment">// skip the first two preamble bytes and the last two checksum bytes, they are not part of the checksum</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> uint8_t* ptr = data + 2, *ptrEnd = data + (dataLength - UBLOX_CHECKSUM_SIZE); ptr != ptrEnd; ptr++)</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            checksum1 += *ptr;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            checksum2 += checksum1;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    DECLARE_M_RAW;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    uint8_t m_messageId;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    uint8_t m_classId;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;};</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno"><a class="line" href="classc_gps_parser.html#aeef2b134ff51e193c5723eb26ffead58">  508</a></span>&#160;<a class="code" href="classc_gps_parser.html">cGpsParser</a>* <a class="code" href="classc_gps_parser.html#aeef2b134ff51e193c5723eb26ffead58">cGpsParser::CreateParser</a>(eGpsParserType type, <a class="code" href="classi_gps_parser_delegate.html">iGpsParserDelegate</a>* delegate)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;{</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">switch</span> (type)</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">case</span> GpsParserTypeInertialSense:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classc_inertial_sense_parser.html">cInertialSenseParser</a>(delegate);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">case</span> GpsParserTypeUblox:</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classc_ublox_parser.html">cUbloxParser</a>(delegate);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">case</span> GpsParserTypeRtcm3:</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classc_rtcm_parser.html">cRtcmParser</a>(delegate);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;}</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="classc_gps_parser.html#a5600c0ca39301545821df51a0292d270">  526</a></span>&#160;<a class="code" href="classc_gps_parser.html#a5600c0ca39301545821df51a0292d270">cGpsParser::cGpsParser</a>(<a class="code" href="classi_gps_parser_delegate.html">iGpsParserDelegate</a>* delegate)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;{</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    assert(delegate != NULL);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    m_delegate = delegate;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;}</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#if defined(__GNUC__)</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#pragma GCC diagnostic pop</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="classi_gps_parser_delegate_html_a592450747817cba6ca018c4fe99281b4"><div class="ttname"><a href="classi_gps_parser_delegate.html#a592450747817cba6ca018c4fe99281b4">iGpsParserDelegate::OnPacketReceived</a></div><div class="ttdeci">virtual bool OnPacketReceived(const cGpsParser *parser, const uint8_t *data, uint32_t dataLength)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00060">GpsParser.h:60</a></div></div>
<div class="ttc" id="classc_ublox_parser_html_a4daf658f9f6edf2cc1bbf6dfe5a60660"><div class="ttname"><a href="classc_ublox_parser.html#a4daf658f9f6edf2cc1bbf6dfe5a60660">cUbloxParser::WriteByte</a></div><div class="ttdeci">void WriteByte(uint8_t b) OVERRIDE</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00357">GpsParser.cpp:357</a></div></div>
<div class="ttc" id="structgtime__t_html_a8b130d86698a8a9e3c3a7a5c590eb392"><div class="ttname"><a href="structgtime__t.html#a8b130d86698a8a9e3c3a7a5c590eb392">gtime_t::time</a></div><div class="ttdeci">time_t time</div><div class="ttdef"><b>Definition:</b> <a href="data__sets_8h_source.html#l01332">data_sets.h:1332</a></div></div>
<div class="ttc" id="classc_gps_parser_html_a1bf50414df7d8d053cdd09bf04679253"><div class="ttname"><a href="classc_gps_parser.html#a1bf50414df7d8d053cdd09bf04679253">cGpsParser::GetReceiverIndex</a></div><div class="ttdeci">int32_t GetReceiverIndex() const </div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00176">GpsParser.h:176</a></div></div>
<div class="ttc" id="classc_ublox_parser_html_a52295ab27f45764fbb6f145e34acdedd"><div class="ttname"><a href="classc_ublox_parser.html#a52295ab27f45764fbb6f145e34acdedd">cUbloxParser::ParseMessage</a></div><div class="ttdeci">void ParseMessage(const uint8_t *data, int dataLength) OVERRIDE</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00425">GpsParser.cpp:425</a></div></div>
<div class="ttc" id="classc_gps_parser_html_aeef2b134ff51e193c5723eb26ffead58"><div class="ttname"><a href="classc_gps_parser.html#aeef2b134ff51e193c5723eb26ffead58">cGpsParser::CreateParser</a></div><div class="ttdeci">static cGpsParser * CreateParser(eGpsParserType type, iGpsParserDelegate *delegate)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00508">GpsParser.cpp:508</a></div></div>
<div class="ttc" id="classi_gps_parser_delegate_html_ab711598d3e65ae1b7ba4e7a04afedc29"><div class="ttname"><a href="classi_gps_parser_delegate.html#ab711598d3e65ae1b7ba4e7a04afedc29">iGpsParserDelegate::OnGlonassEphemerisReceived</a></div><div class="ttdeci">virtual void OnGlonassEphemerisReceived(const cGpsParser *parser, const geph_t *geph, int prn)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00098">GpsParser.h:98</a></div></div>
<div class="ttc" id="classi_gps_parser_delegate_html_a94a8e9fc5ffaf0635a5c19d468701a48"><div class="ttname"><a href="classi_gps_parser_delegate.html#a94a8e9fc5ffaf0635a5c19d468701a48">iGpsParserDelegate::OnSbsReceived</a></div><div class="ttdeci">virtual void OnSbsReceived(const cGpsParser *parser, const sbsmsg_t *sbs)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00110">GpsParser.h:110</a></div></div>
<div class="ttc" id="classc_inertial_sense_parser_html_a946b92985b6663bccd5f02d6afee1776"><div class="ttname"><a href="classc_inertial_sense_parser.html#a946b92985b6663bccd5f02d6afee1776">cInertialSenseParser::WriteByte</a></div><div class="ttdeci">void WriteByte(uint8_t b) OVERRIDE</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00137">GpsParser.cpp:137</a></div></div>
<div class="ttc" id="classc_gps_parser_html_ac5aa480f135a3405b720bc7bc370a5ac"><div class="ttname"><a href="classc_gps_parser.html#ac5aa480f135a3405b720bc7bc370a5ac">cGpsParser::ParseMessage</a></div><div class="ttdeci">virtual void ParseMessage(const uint8_t *data, int dataLength)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00183">GpsParser.h:183</a></div></div>
<div class="ttc" id="classc_ublox_parser_html"><div class="ttname"><a href="classc_ublox_parser.html">cUbloxParser</a></div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00346">GpsParser.cpp:346</a></div></div>
<div class="ttc" id="structgtime__t_html"><div class="ttname"><a href="structgtime__t.html">gtime_t</a></div><div class="ttdef"><b>Definition:</b> <a href="data__sets_8h_source.html#l01329">data_sets.h:1329</a></div></div>
<div class="ttc" id="classc_inertial_sense_parser_html"><div class="ttname"><a href="classc_inertial_sense_parser.html">cInertialSenseParser</a></div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00129">GpsParser.cpp:129</a></div></div>
<div class="ttc" id="classc_rtcm_parser_html_aa49ac9396fcf583ddbb1f7bcf2e6af71"><div class="ttname"><a href="classc_rtcm_parser.html#aa49ac9396fcf583ddbb1f7bcf2e6af71">cRtcmParser::WriteByte</a></div><div class="ttdeci">void WriteByte(uint8_t b) OVERRIDE</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00192">GpsParser.cpp:192</a></div></div>
<div class="ttc" id="classc_gps_parser_html_a5600c0ca39301545821df51a0292d270"><div class="ttname"><a href="classc_gps_parser.html#a5600c0ca39301545821df51a0292d270">cGpsParser::cGpsParser</a></div><div class="ttdeci">cGpsParser(iGpsParserDelegate *delegate)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00526">GpsParser.cpp:526</a></div></div>
<div class="ttc" id="classi_gps_parser_delegate_html_ad51fee5d3324537e4a9a8664237b8626"><div class="ttname"><a href="classi_gps_parser_delegate.html#ad51fee5d3324537e4a9a8664237b8626">iGpsParserDelegate::OnGpsEphemerisReceived</a></div><div class="ttdeci">virtual void OnGpsEphemerisReceived(const cGpsParser *parser, const eph_t *eph, int prn)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00085">GpsParser.h:85</a></div></div>
<div class="ttc" id="classc_gps_parser_html"><div class="ttname"><a href="classc_gps_parser.html">cGpsParser</a></div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00128">GpsParser.h:128</a></div></div>
<div class="ttc" id="classi_gps_parser_delegate_html_a1fea12f01b07177946f1ce10cd26eb9a"><div class="ttname"><a href="classi_gps_parser_delegate.html#a1fea12f01b07177946f1ce10cd26eb9a">iGpsParserDelegate::OnStationReceived</a></div><div class="ttdeci">virtual void OnStationReceived(const cGpsParser *parser, sta_t *sta)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00121">GpsParser.h:121</a></div></div>
<div class="ttc" id="classi_gps_parser_delegate_html_a3d84621cccf117972b96af70c6e2c86a"><div class="ttname"><a href="classi_gps_parser_delegate.html#a3d84621cccf117972b96af70c6e2c86a">iGpsParserDelegate::OnObservationReceived</a></div><div class="ttdeci">virtual void OnObservationReceived(const cGpsParser *parser, const obs_t *obs)</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00073">GpsParser.h:73</a></div></div>
<div class="ttc" id="classc_rtcm_parser_html_ae85ccd9e816c808f696f730f10b34b45"><div class="ttname"><a href="classc_rtcm_parser.html#ae85ccd9e816c808f696f730f10b34b45">cRtcmParser::ParseMessage</a></div><div class="ttdeci">void ParseMessage(const uint8_t *data, int dataLength) OVERRIDE</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00268">GpsParser.cpp:268</a></div></div>
<div class="ttc" id="classc_gps_parser_html_a3bb55b5835ba5fcea42b9a8fa824c945"><div class="ttname"><a href="classc_gps_parser.html#a3bb55b5835ba5fcea42b9a8fa824c945">cGpsParser::GetDelegate</a></div><div class="ttdeci">iGpsParserDelegate * GetDelegate()</div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00164">GpsParser.h:164</a></div></div>
<div class="ttc" id="classi_gps_parser_delegate_html"><div class="ttname"><a href="classi_gps_parser_delegate.html">iGpsParserDelegate</a></div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8h_source.html#l00050">GpsParser.h:50</a></div></div>
<div class="ttc" id="classc_rtcm_parser_html"><div class="ttname"><a href="classc_rtcm_parser.html">cRtcmParser</a></div><div class="ttdef"><b>Definition:</b> <a href="_gps_parser_8cpp_source.html#l00182">GpsParser.cpp:182</a></div></div>
<div class="ttc" id="struct_p_a_c_k_e_d_html"><div class="ttname"><a href="struct_p_a_c_k_e_d.html">PACKED</a></div><div class="ttdef"><b>Definition:</b> <a href="data__sets_8h_source.html#l00489">data_sets.h:489</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 30 2017 04:31:04 for SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
